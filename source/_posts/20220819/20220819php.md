---
categories:
  - programming
tags:
  - [php]
date: 2022-08-19 11:42:05
title: phpファイルの閉じ処理「?>」は書かないようにしようね
---

<!-- toc -->

<!-- more -->

## phpの閉じカッコについて

phpをファイル内に記載するときは、`<?php`内に処理を記載する。こちらの末尾の`?>`は基本的には不要だ。

```php

<?php
// phpの本文
?>

```

これで良い。

```php

<?php
// phpの本文

```

なぜかというと、php処理を閉じてしまったあとに、２行以上の改行がある場合、**文字列としてファイルが空白文字を出力してしまうケースが有る**
ちなみに、１行の空白行であれば、phpがいい感じに処理してくれるようだが、2行以上あるとそれ移行は、アウトプットされてしまう。要するに、htmlタグなどを記載しているのと同じ状況になるというわけだ。

意図しないアウトプットが発生することにより、このようなエラーが発生する
`Warning: Cannot modify header information - headers already sent by XXX`

これは、アウトプット直後にheaderを更新するリクエストを贈ろうとした際に発生するので、空白行が存在していると、発生する

こういう事情から、末尾の`?>`はViewの役割を持つHTMLタグを記載する箇所以外では使わないほうが、自然であろう。

## 余談

更に付け加えると公式ドキュメントのheader関数にて記載がある

> header() 関数は、 通常の HTML タグまたは PHP からの出力にかかわらず、
> すべての実際の 出力の前にコールする必要があることです。
> 頻出するエラーとして、include または require 関数、
> 他のファイルをアクセスする関数に 空白または空行があり、
> header() の前に出力が 行われてしまうというものがあります

[PHP: header - Manual](https://www.php.net/manual/ja/function.header.php)

headerを書き換える処理は、<?phpの上にも何も書いてはだめ。
classの関数呼び出しの際は、上から処理を取得するってことではないのかな？
挙動がわからないけど、閉じカッコは使わないほうが良さそう

```php
<html>
<?php
/* これはエラーとなります。この上に出力があることに注目してください。
 * それはheader()のコールより前であるということになります */
header('Location: http://www.example.com/');
exit;
?>
```

## 参考文献

[PHP の `headers already sent` エラーはどう直したらいいですか？ - スタック・オーバーフロー](https://ja.stackoverflow.com/questions/5453/php-%E3%81%AE-headers-already-sent-%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%AF%E3%81%A9%E3%81%86%E7%9B%B4%E3%81%97%E3%81%9F%E3%82%89%E3%81%84%E3%81%84%E3%81%A7%E3%81%99%E3%81%8B)
