---
title: シェルスクリプトのxargs内で複数の変数を使用する
categories:
  - programming
tags:
  - [coding]
  - [shell]
date: 2022-08-17 10:04:19
---

<!-- toc -->

## Summary

- シェルでワンライナーで加工前の変数と加工後の変数を使用する方法
- `shell -c 'XX'`を用いる

<!-- more -->

## ユースケース

特定のファイルの出力ファイルをディレクトリ名から取得する

```sh
$ ls -1
apple-ringo.txt
fish-sakana.txt
```

### 実行するシェル

```sh
find ./app/tests/ -name *.txt | xargs -I@ sh -c " VAR=`sed 's/-//g'`; phpunit @ --coverage-php reports/$VAR.php"
```

### 解説

実行シェルの`find`で、app/tests配下のファイルを全取得する

```sh
$ find ./app/tests/ -name *.txt
app/tests/apple-ringoTest.php
app/tests/fish-sakanaTest.php
```

その後`xargs -I@`で取得した値を引数として渡すが、引数の１つを加工したい。

1. `sed`で置換した値を`VAR`という変数に代入。（変数にコマンド結果を代入したい場合はバッククオートを使う)
2. その後、セミコロンで次の処理を書く
3. @内の変数とVARの変数がそれぞれ使用できるので記載する
4. 1~3までの処理を`sh -c`で囲んであげる

最終的に下記のようなコマンド郡が実行される

```sh
phpunit app/tests/apple-ringoTest.php --coverage-php reports/appleringoTest.php
phpunit app/tests/fish-sakanaTest.php --coverage-php reports/fishsakanaTest.php
```

これでよし
