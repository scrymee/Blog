---
categories:
  - programming
tags:
  - [shell]
  - [sed]
date: 2022-09-05 10:46:41
title: Sedで前のデータを使いたいときの「¥1」後方参照の使い方
---

<!-- toc -->

<!-- more -->

## ¥1は後方参照と言われるもの

¥1を用いると前のデータをそのまま引用することができる。

つまり`mv`などで一括リネームするときなどに活用できる

そもそも、¥1の使い方を確認する。

まずこれを使う。

ここでのxargsは引数を1つにすることで縦に見やすくするために使っている。xargsはコマンドを入力しないと`xargs echo`と同じ意味になる

```sh
echo 'apple banana' | xargs -n1
apple
banana
```


## 後方参照の確認

正規表現を用いて確認する

```sh
echo 'apple banana' | xargs -n1 | sed -r 's/^(....)/¥1 ¥1 /g'
appl appl e
bana bana na
```

つまり文頭4文字を置換する処理を書いた。置換したい箇所を括弧で囲むと、後で置換対象を¥1と参照できる


またこれは2つ以上も用いることができるので覚えておこう。

```sh
echo 'apple banana' | xargs -n1 | sed -r 's/^(..)(..)/¥1 -> ¥2 /g'
app -> le 
ban -> an a
```

完全に余談だが、確認のために下記のように書くと置換前のデータが全て出力されているように誤解した。これは置換対象と、それ以外がそのままくっつくことであたかも同じように見えることだ。

```sh
echo 'apple banana' | xargs -n1 | sed -r 's/^(....)/¥1 ¥1/g'　# 上との違いは末尾に半角スペースがない
appl apple
bana banana

echo 'apple banana' | xargs -n1 | sed -r 's/^(..)/¥1/g'　# 上との違いは末尾に半角スペースがない
apple
banana
```

つまり、これを用いたらファイル名の数字をディレクトリ階層へと変更する処理も可能だ


## ディレクトリ置換

本来echoでかいているところはlsなどで実行していると考えて欲しい

```sh
echo '20201231test.txt' | sed -r 's|^(........)(.+)|¥1¥2 ¥1/¥2|g' | xargs -n2 mv
```

これでよい。実行は下記のようになる

```sh
mv 20201231test.txt 20201231/test.txt
```

ただ、`mv`コマンドは、ディレクトリがない場合失敗するためディレクトリを作成する操作も必要にな
