---
categories:
  - programming
tags:
  - [security]
date: 2022-09-26 11:25:39
title: エンコード処理と認証によるセキュアプログラミング
---

<!-- toc -->

<!-- more -->

## セキュアなプログラミング(表示に関して)

入力値検証→処理→DBやブラウザへの受け渡しというフローでは下記のようなケースでは、
入力値検証としては正しいが、DBにわたすときにすると全件を取得しうる
`'aiueo'or'1'!='@examle.com`

処理が誤解・誤動作しないようにエスケープとエンコードを行う

## ブラウザにデータを渡す際もセキュアな設定が必要

例えば、タグの説明をする場合は、タグと文字列を区別する必要がある。エンコードによってエスケープする必要がある。

### ブラウザに渡すとき
HTMLエンティティエンコーディング
→PHPであれば、`htmlspecialchars`によってエンコーディング

### DBに渡すとき
プリペアステートメント

## フレームワークを使うか、使用するメソッドなどを定義しておく

フレームワークとかは自動で設定してくれることが多いので、特徴を確認して、FWを使おうね
（忘れてしまうので）

約束事は決めておいて共有しておくことが大事
- DBの取得はFWのfindメソッドを使う・・・など。

## データを渡すあらゆる箇所にエンコード処理は必要

渡す処理だけエンコードが必要
-> エンコードされていないように見える場合は理由をコメントアウト等に記載（コードレビュー）

## アクセス制御について

WOASPのTOP10として脅威になっている

認証を突破されると下記のような事例がある。

- ユニクロのパスワードリスト攻撃
- 他人の注文履歴が見える


アクセス制御によって、与えられた権限のみ利用できるようにする（IAMなど）

## 認証と認可を組み合わせてアクセス制御を行う

認証（本人確認）と認可（権限の許可）を組み合わせて利用する

## アクセス制御の不備の事例

直接リクエストするとだめなケース（curlなど）
注文取る奥画面にはアクセスできないがAPIはアクセスできてしまう・・・

## アクセス制御はあらゆるアプリ（サービス単位で）見るべき

WebアプリだけでなくAzureやCMysqlなどLIなどでもいくつも認証される

## 認証と認可の指標

Authentication Cheat Sheet
Authorization Cheat Sheet

## 他の人に情報を与えない

攻撃者のヒントに鳴るエラーメッセージは避ける
IDとパスワードを入力して失敗したときに、「パスワードが間違っています」（暗にIDとはあっていると説明している）

## 1つの方法が突破されても複数の突破が必要になる

再認証は、session IDなどをなりすましたときに使える
全権限を持つユーザーは作らない

## 認証認可周りはログを残す

認可で拒否されたリクエストはロギングする。バグか悪意にあるアタックなのかを判断できる